<html>
<head>
	<meta name="viewport" content="width=device-width">

	<title>Sasquatch :: Todo Application Tutorial</title>

	<!-- CSS -->
	<link rel="stylesheet" href="css/highlight.css">
	<link rel="stylesheet" href="css/style.css">

	<!-- Fonts -->
	<link href='http://fonts.googleapis.com/css?family=Oswald:400,300' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,400italic' rel='stylesheet' type='text/css'>

	<link rel="shortcut icon" href="favicon.gif" type="image/x-icon" />
</head>
<body>
	<div class="topbar"></div>
	<div class="wrap">
		<div class="sidebar">
			<a href="index.html" id="logo">
				<img src="img/blinking-eyes.gif" alt="" class="blink">
				<img src="img/sasquatch.png" alt="Sasquatch JS">
			</a>
			<ul class="submenu">
				<li><a href="#create-project">Create Project</a></li>
				<li><a href="#project-structure">Project Structure</a></li>
				<li><a href="#template">template.html</a></li>
				<li><a href="#create-view-controller">Create a New View/Controller</a></li>
				<li><a href="#your-first-view">Your First View</a></li>
				<li><a href="#your-first-controller">Your First Controller</a></li>
				<li><a href="#create-view">Create a view to make a todo list</a></li>
				<li><a href="#create-todo-view">Create the todo view</a></li>
				<li><a href="#show-all-todo-lists">Showing All Todo Lists</a></li>
			</ul>
		</div>
		<div class="content-column">
			<div class="menu">
				<select name="sections" id="drop_menu">
					<option value="navigation">Navigation</option>
					<option value="index.html">Home</option>
					<option value="commandline.html">Commandline</option>
					<option value="api.html">JS API</option>
					<option value="gettingstarted.html">Get Started</option>
					<option value="todo.html">Tutorial</option>
				</select>
				<ul>
					<li><a href="index.html">Home</a></li>
					<li>/</li>
					<li><a href="commandline.html">Commandline</a></li>
					<li>/</li>
					<li><a href="api.html">JS API</a></li>
					<li>/</li>
					<li><a href="gettingstarted.html">Get Started</a></li>
					<li>/</li>
					<li><a href="todo.html" class="active">Tutorial</a></li>
				</ul>
			</div>
			<div class="clearfix"></div>
			<div class="content">
			<h1>Todo App Tutorial</h1>

			<p>In this tutorial, you will learn how to use Sasquatch to build a simple todo tracking application.
				In the process of building the application, you will be exposed to all the major components of the Sasquatch framework.</p>

			<section>
				<h2 id="create-project">Create the project</h2>
				<p>
					First thing we want to do is create a new project. We can do this by typing into the console:
				</p>
				<pre class="no-num"><code>sasquatch create-project todo</code></pre>
				<p>
					A directory called todo will be created containing a skeleton project.
				</p>
			</section>
			<section>
				<h2 id="project-structure">Project Structure</h2>
				<p>
					Entering into the newly created directory, you will see your project with a file structure like this:
				</p>
				<pre class="no-num"><code>
- todo
  - controller/
  - view/
  - partial/
  - lib/
  - img/
  - style/
  - app.json
  - config.json
  - routes.json
  - template.html
</code></pre>
			</section>
			<section>
				<h2 id="template">template.html</h2>
				<p>
					Go ahead and open the template.html file in your favorite text editor. You will see your django template file with a few for loops that output css and javascript tags into the webpage. In addition, there is a basic webpage structure with a HEAD, BODY, and DIV with a class of <em>content</em>. The DIV with a class of <em>content</em> is important, its the location on this basic webpage that will hold all the of views rendered by the Sasquatch MVC framework. For now, don't worry too much about it. Just understand that Sasquatch renders all its HTML views and outputs them into that DIV.
				</p>
				<p>
					If you also open the config.json file you can see a json file with two keys, "rootElement" and "defaultView". "rootElement" is the jQuery selector for where you want to insert your views into the template file. Note that it is set to ".content" which matches the DIV from the template.html file. The second property is "defaultView", which refers to what controller/view combination should be loaded up and rendered when a user first visits the webapp. For now, change this to "todo".
				</p>
			</section>
			<section>
				<h2 id="create-view-controller">Create a New View/Controller</h2>
				<p>
					Views and controllers are the heart of Sasquatch. They implement the business logic of the application and render changes to the HTML Document. We would like to create our first view and controller. This can be done by typing the following into the console from the root of your project.
				</p>
<pre class="no-num"><code>sasquatch create-view index</code></pre>
				<p>This creates two files, one in the "view" directory called "index.erb" and another in the controller directory called "index.js"</p>
			</section>
			<section>
				<h2 id="your-first-view">Your First View</h2>
				<p>
					Go to the view directory and you will see your newly created index.erb file. You will also see another file, second.erb, you can delete it is just a sample file.
				</p>
				<p>
					Upon opening the index.erb file, you notice its blank. Sasquatch isn't that good. You will need to provide some html of your own to render on the page. Toss this into index.erb:
				</p>
				<pre class="no-num"><code> &lt;h1&gt; Hello Sasquatch! &lt;/h1&gt; </code></pre>
			</section>
			<section>
				<p>In the root of the project open routes.json. You will see some sample routes already there. The first one maps the base route to the index controller. The second route maps "second/:heading:" to the second controller. The ":heading:" part is an optional route parameter. Required route parameters look like "{heading}". The parameters get injected into your controller so you can use them at runtime.
				</p>
				<p>For now, you can delete the second route. Your routes.json file should now look like this:</p>
				<pre class="no-num"><code>{
	"" : {
		"controller" : "index"
	}
}</code></pre>
				<p>You are now set to preview your first Sasquatch view. Run the following from the root of your project:</p>
				<pre class="no-num"><code>sasquatch dev server</code></pre>
				<p>This commands does three useful things. First, it creates a development build of the application that is easy to debug (easy to debug). Second, a file watcher is added the project files that will automatically recompile the application when you make changes. Third, it boots up a local development server at localhost:8000/bin/ so you can test your application. Navigating there to see the Hello Sasquatch heading.</p>
			</section>
			<section>
				<h2 id="your-first-controller">Your First Controller</h2>
				<p>
					The "create-view" command also creates a controller by the same name as the view. You can find your controller in the appropriately named "controller" directory. Open controller/index.js in you favorite text editor. You will also see one other file, second.js, you can delete that as it is just sample a file.
				</p>
				<p>
					Controllers are written using the CommonJS module pattern.
					Controller modules are expected to "export" three specific functions for Sasquatch.
					The first function is the "loadData".
					In this function, you get all the parameters you defined in the routes.json file which is often used to load remote data.
					"loadData" recieves two arguments, the first is an object with the named parameters you defined in your routes.json file.
					The second argument is a callback function where you provide a data object used to power the view templating (todo.erb)
				</p>
				<p>Go ahead and add a key and value to the callback like so:</p>
<pre class="javascript"><code>
exports.loadData = function(data, callback){
  console.log("view ready:todo");
  callback({
    heading: "My first todo app"
  });
};
</code></pre>
        <p>Now switch back to index.erb in your view directory and replace the previous HTML with this text:</p>
<pre class="html"><code>
&lt;h2&gt;&lt;%= heading %&gt;&lt;/h2&gt;
</code></pre>
        <p>Reload your browser and you should now see "My first todo app" as a heading on your view (remember to have "sasquatch dev server" running)</p>
			</section>
			<section>
				<h2 id="create-view">Create a view to make a todo list</h2>
				<p>Create another view and controller called "new-todo"</p>
				<pre class="no-num"><code>sasquatch create-view new-todo</code></pre>
				<p>First thing we need to do is hook up our new view and controller to the routes.
					Open routes.json and add a new route.
					Your routes should now look something like this:</p>
<pre class="javascript"><code>
{
	"" : {
		"controller" : "index"
	},
	"todo/new" : {
	  "controller" : "new-todo"
	}
}
</code></pre>
        <p>Lets also add some logic to the new-todo.js controller we just created:</p>
<pre class="javascript"><code>
exports.loadData = function(data, callback){
    callback({
			heading: "Create a New Todo List"
		});
};

exports.onReady = function(){
	$('#new_todo').when('submit', function(e) {
		e.preventDefault();
		var todo_name = $('.todo_name').val()
		Services.addTodo(todo_name, function(result) {
			$.goReplace('todo', {name:todo_name});
		});
	});
};

exports.onFinished = function(){
    console.log("view exiting:todo-new");
};
</code></pre>
      <p>The templating system for Sasquatch is underscore's template method.
		  You can interpolate any javascript you'd like into the template including strings or numbers passed into the loadData callback.
	  </p>

	  <p>We need to add some logic to our view new-todo.erb, toss this in there:</p>
<pre class="html"><code>
&lt;h1&gt;&lt;%= heading %&gt;&lt;/h1&gt;
&lt;form id="new_todo"&gt;
  &lt;label for="todo_name"&gt;Todo List Name&lt;/label&gt;
	&lt;input type="text" name="todo_name" class="todo_name"&gt;&lt;/input&gt;
	&lt;button type="submit" name="create_todo" class="create_todo"&gt;Create Todo&lt;/button&gt;
&lt;/form&gt;
</code></pre>
      <p>
		You may have noticed in the controller code we had a call to a function called "Services.addTodo".
		Sasquatch is backend agnostic, meaning you can structure your webservice calls anway you'd like.
		Whether you are using jQuery's builtin ajax methods or Socket.IO, Sasquatch tries to let you do things anyway you'd like.
	</p>
	<p>
		For this example, we're using a simple service interface available under the "Services" namespace.
		Lets create the library file for this inside the "lib" directory.
		Name the file "services.js" and add the following logic to manage the Todo model:
	 </p>
<pre class="javascript"><code>
Services = {
	todos: {},
	addTodo: function(todo_name, callback) {
		var todo = Services.createNewTodo(todo_name);
		callback(todo);
	},
	createNewTodo: function(name) {
		Services.todos[name] = {
			tasks: []
		};
		return Services.todos[name];
	}
}
</code></pre>
        <p>Also in the new-todo.js controller there was another function used call $.goReplace. This function is used to make the webapp go to a new hash/route, while replacing the current hash in the history stack.
				It takes two params, the first is the controller it should reroute to, and the second is the data it should pass along with that call. This currently does not work beacuse we need to to create the new view and controller that displays our newly created todo list</p>
			</section>
			<section>
				<h2 id="create-todo-view">Create the todo view</h2>
				<p>The last controller and view we are going to make is the todo view where we can add tasks to our todo list</p>
				<pre class="no-num"><code>sasquatch create-view todo</code></pre>
				<p>Adding the logic to the newly created todo.js</p>
<pre class="javascript"><code>
exports.loadData = function(data, callback){
	Services.getTodo(data.name, function(tasks) {
		callback({
			name: data.name,
			tasks: tasks
		});
	});
};

exports.onReady = function(){
	$('#new_task').when('submit', function(e) {
		e.preventDefault();
		var todo = $('.todo_name').val();
		var task = $('.task').val();

		Services.addTask(todo, task, function(result) {
			console.log(result)
			var partial = $.partial('task', {task:task, pos:result.pos});
			$('.task_list').append(partial);
		});
		$('#new_task input.task').val('');
		return false;
	});

	$('.task_list').when('click', 'li', function() {
		var self = this;
		var task = $(this).attr('index');
		var todo = $(this).closest('ul').attr('todo');
		Services.completeTask(todo, task, function(result) {
			$(self).remove();
			$('.task_list li').each(function(i, v) {
				$(this).attr('index', i);
			});
		});
	});
};

exports.onFinished = function(){
    console.log("view exiting:todo");
};
</code></pre>
        <p>Wooo, you say, thats alot of stuff. First we have a new Services function that we call in the loadData phase,
					this makes a call with the todo list name, fetching it and returning it in the callback function we passed.
					This in turn calls the callback function to the loadData function letting the framework know we are done loading data and it can go ahead and render the template.</p>
				<p>The code in the onLoad function is fairly straight forward, we create two events that use the "$.when" method which is exactly the same as jQuery's "$.on" method.
					The only difference is it automatically unbinds the event with jQuery's "off" method when the page changes.
					In those two events we call the Services layer again, one to add a task to the todo list and another to remove a task from the todo list. To finish this code, lets add the three new Services.</p>
<pre class="javascript"><code>
getTodo: function(todo_name, callback) {
  var todo = Services.todos[todo_name];
  callback(todo ? todo.tasks : []);
},
addTask: function(todo, task, callback) {
  Services.todos[todo].tasks.push(task);
  callback({success:true, pos:Services.todos[todo].tasks.length - 1});
},
completeTask: function(todo, task, callback) {
  Services.todos[todo].tasks.splice(task, 1);
  callback({success:true});
}
</code></pre>
        <p>We also need to setup our new route, open routes.json and add a new route. This time we are going to use a special pattern that will add a required parameter to the route, which then can be used in the loadData function of the controller, (which we already setup the logic for)</p>
<pre class="javascript"><code>
{
	"" : {
		"controller" : "index"
	},
	"todo/new" : {
	  "controller" : "new-todo"
	},
	"todo/{name}" : {
		"controller" : "todo"
	}
}
</code></pre>
        <p>Adding the {name} makes the route need a parameter after the todo/ and it is stored in the data object of loadData in our controller.</p>
				<p>To round things off we need to add the HTML to the view todo.erb</p>
<pre class="html"><code>
&lt;h1&gt;Todo: &lt;%= name %&gt;&lt;/h1&gt;
&lt;ul class="task_list" todo="&lt;%= name %&gt;"&gt;
&lt;% _.each(tasks, function(task, i) { %&gt;
	 &lt;%= $.partial('task', {task:task, pos:i}) %&gt;
&lt;% }); %&gt;
&lt;/ul&gt;

&lt;form id="new_task"&gt;
  &lt;label for="task"&gt;Add Task&lt;/label&gt;
	&lt;input type="text" name="task" class="task"&gt;&lt;/input&gt;
	&lt;input type="hidden" value="&lt;%= name %&gt;" name="todo_name" class="todo_name"&gt;&lt;/input&gt;
	&lt;button class="add_task" type="submit"&gt;Add Task&lt;/submit&gt;
&lt;/form&gt;
</code></pre>
        <p>The great thing about sasquatch views is you can use any javascript you have in the lib folder</p>
				<p>You may also see we used a new function you have never seen, the "$.partial" function. This allows you to call and render a partial in the /partial folder in the root of the project.
					It takes two parameters, the first is the name of the partial and the second is a data object of local variables.
					Create a new file called task.erb in the partial folder that looks like this.
				</p>
<pre class="html"><code>
&lt;li index="&lt;%= pos %&gt;">&lt;%= task %&gt;&lt;/li&gt;
</code></pre>
			</section>
			<section>
				<h2 id="show-all-todo-lists">Showing All Todo Lists</h2>
				<p>Lastly lets go back to index.erb and add some logic in to list all the todo lists made:</p>
<pre class="javascript"><code>
exports.loadData = function(data, callback){
	Services.listTodos(function(todos) {
		callback({
			heading: "My Simple Todo App",
			todos: todos
		});
	});
};
</code></pre>
       <p>We simply added a services call with a callback that returns all the todos, then added this to the local variables so we can get them in our view. Now add another function to Services.</p>
<pre class="javascript"><code>
listTodos: function(callback) {
  callback(Services.todos);
}
</code></pre>
      <p>And the new edit view should look like:</p>
<pre class="html"><code>
&lt;h2&gt;&lt;%= heading %&gt;&lt;/h2&gt;
&lt;a href="#/todo/new"&gt;Create new Todo&lt;/a&gt;
&lt;ul&gt;
	&lt;h3&gt;Todos:&lt;/h3&gt;
	&lt;% _.each(todos, function(v, k) { %&gt;
	  &lt;li&gt;&lt;a href="#/todo/&lt;%= k %&gt;"&gt;&lt;%= k %&gt;&lt;/a&gt;&lt;/li&gt;
  &lt;% }); %&gt;
&lt;/ul&gt;
</code></pre>
      <p>We now have a functioning todo list, go back to localhost:8000/bin and see for yourself!</p>
	  <p>If you'd like a completed version of the project you can find it on <a href="https://github.com/ThoughtLeadr/Sasquatch">Github</a>.</p>
    </section>
		</div>
	</div>
	<div class="clearfix"></div>
		<div class="footer">
			<p>
				Copyright <a href="http://thoughtleadr.com/">ThoughtLeadr, Inc</a>, Sasquatch is a <a href="/trademark-policy.pdf">trademark</a> of ThoughtLeadr, Inc.
			</p>
			 <ul>
				<li><a href="index.html" class="home">Home</a></li>
				<li><a href="commandline.html" class="npm current">Commandline</a></li>
				<li><a href="api.html" class="docs">JS API</a></li>
				<li><a href="gettingstarted.html" class="blog">Get Started</a></li>
				<li><a href="todo.html">Tutorial</a></li>
			</ul>
		</div>
</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="http://thoughtleadr.github.com/Sasquatch/js/highlight.js"></script>
	<script src="http://thoughtleadr.github.com/Sasquatch/js/script.js"></script>
	<script src="js/submenu.js"></script>
	<script src="js/mobile-nav.js"></script>
</body>
</html>
